<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UML - Main Classes and Relationships</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 40px 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .diagram-section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #2c3e50;
            font-size: 42px;
            margin-bottom: 10px;
            text-align: center;
        }
        
        h2 {
            color: #667eea;
            font-size: 32px;
            margin: 30px 0 20px 0;
        }
        
        .subtitle {
            color: #666;
            text-align: center;
            margin-bottom: 30px;
            font-size: 18px;
        }
        
        .diagram-container {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            overflow-x: auto;
        }
        
        .mermaid {
            background: white;
            padding: 20px;
            border-radius: 10px;
        }
        
        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .legend-symbol {
            font-size: 24px;
            width: 30px;
            text-align: center;
        }
        
        .info-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-top: 20px;
        }
        
        .info-box h3 {
            font-size: 24px;
            margin-bottom: 15px;
        }
        
        .info-box ul {
            list-style: none;
            padding: 0;
        }
        
        .info-box li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }
        
        .info-box li::before {
            content: '‚úì';
            position: absolute;
            left: 0;
            font-weight: bold;
        }
        
        .relationship-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .rel-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        
        .rel-card h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .rel-card code {
            background: #2c3e50;
            color: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Main Class Relationships -->
        <div class="diagram-section">
            <h1>üèóÔ∏è UML Class Diagram</h1>
            <p class="subtitle">Main Classes and Their Relationships</p>
            
            <div class="diagram-container">
                <div class="mermaid">
classDiagram
    class DashApp {
        +create_dash_app()
        +update_graph()
        +ai_search()
    }
    
    class FastAPIApp {
        +route_to_pages()
        +route_to_dash()
        +route_to_api()
    }
    
    class Neo4jQueryEngine {
        -driver
        +query_graph_with_filters()
        +get_survey_data()
        +prepare_context()
    }
    
    class Neo4jRAG {
        -driver
        -model
        +index_relationships()
        +retrieve_relevant_context()
        +get_stats()
    }
    
    class GraphVisualizer {
        -graph
        -positions
        +build_graph()
        +calculate_layout()
        +create_plotly_figure()
    }
    
    class FilterManager {
        -df
        -filter_values
        +extract_all_filters()
        +validate_filter_values()
    }
    
    class Neo4jDatabase {
        &lt;&lt;external&gt;&gt;
    }
    
    class SurveyData {
        &lt;&lt;external&gt;&gt;
    }
    
    class ClaudeAPI {
        &lt;&lt;external&gt;&gt;
    }
    
    FastAPIApp --> DashApp
    DashApp --> Neo4jQueryEngine
    DashApp --> Neo4jRAG
    DashApp --> GraphVisualizer
    DashApp --> FilterManager
    Neo4jQueryEngine --> Neo4jDatabase
    Neo4jQueryEngine --> SurveyData
    Neo4jRAG --> Neo4jDatabase
    Neo4jRAG --> ClaudeAPI
    FilterManager --> Neo4jQueryEngine
    GraphVisualizer ..> Neo4jQueryEngine
                </div>
            </div>
            
            <!-- Legend -->
            <div class="legend">
                <div class="legend-item">
                    <span class="legend-symbol">‚Üí</span>
                    <span><strong>Dependency:</strong> Class uses/calls another class</span>
                </div>
                <div class="legend-item">
                    <span class="legend-symbol">‚ãØ‚Üí</span>
                    <span><strong>Uses:</strong> Temporary dependency (data flow)</span>
                </div>
                <div class="legend-item">
                    <span class="legend-symbol">üü¶</span>
                    <span><strong>Blue:</strong> Application/Entry Points</span>
                </div>
                <div class="legend-item">
                    <span class="legend-symbol">üü©</span>
                    <span><strong>Teal:</strong> Core Business Logic</span>
                </div>
                <div class="legend-item">
                    <span class="legend-symbol">üüß</span>
                    <span><strong>Orange:</strong> AI/RAG Components</span>
                </div>
                <div class="legend-item">
                    <span class="legend-symbol">üü¶</span>
                    <span><strong>Dark Blue:</strong> External Data Sources</span>
                </div>
            </div>
        </div>
        
        <!-- Simplified Architecture View -->
        <div class="diagram-section">
            <h2>üìê Simplified Architecture View</h2>
            
            <div class="diagram-container">
                <div class="mermaid">
graph TB
    User([User])
    
    subgraph Entry[Entry Points]
        FastAPI[FastAPI]
        Pages[Pages]
        Dashboard[Dashboard]
        API[REST API]
    end
    
    subgraph Core[Core Logic]
        QueryEngine[Neo4jQueryEngine]
        RAG[Neo4jRAG]
        Viz[GraphVisualizer]
        Filters[FilterManager]
    end
    
    subgraph Data[Data Layer]
        Neo4j[(Neo4j)]
        CSV[(CSV Files)]
    end
    
    subgraph AI[AI Layer]
        Claude[Claude API]
        Embeddings[Embeddings]
    end
    
    User --> FastAPI
    FastAPI --> Pages
    FastAPI --> Dashboard
    FastAPI --> API
    Dashboard --> QueryEngine
    Dashboard --> RAG
    Dashboard --> Viz
    Dashboard --> Filters
    API --> QueryEngine
    API --> Filters
    QueryEngine --> Neo4j
    QueryEngine --> CSV
    RAG --> Neo4j
    Filters --> QueryEngine
    RAG --> Embeddings
    RAG --> Claude
    Dashboard --> Claude
    Viz --> QueryEngine
                </div>
            </div>
            
            <div class="info-box">
                <h3>üéØ Key Architectural Principles</h3>
                <ul>
                    <li><strong>Layered Architecture:</strong> Clear separation between Entry, Core, Data, and AI layers</li>
                    <li><strong>Single Responsibility:</strong> Each class has one well-defined purpose</li>
                    <li><strong>Dependency Injection:</strong> Database connections passed to constructors</li>
                    <li><strong>Loose Coupling:</strong> Classes depend on interfaces, not implementations</li>
                    <li><strong>High Cohesion:</strong> Related functionality grouped together</li>
                </ul>
            </div>
        </div>
        
        <!-- Relationship Details -->
        <div class="diagram-section">
            <h2>üîó Relationship Details</h2>
            
            <div class="relationship-types">
                <div class="rel-card">
                    <h4>DashApp ‚Üí Neo4jQueryEngine</h4>
                    <p><strong>Type:</strong> Dependency</p>
                    <p><strong>Purpose:</strong> Dashboard queries database for filtered graph data</p>
                    <p><strong>Method:</strong> <code>query_graph_with_filters()</code></p>
                </div>
                
                <div class="rel-card">
                    <h4>DashApp ‚Üí Neo4jRAG</h4>
                    <p><strong>Type:</strong> Dependency</p>
                    <p><strong>Purpose:</strong> AI Search Agent uses RAG for semantic search</p>
                    <p><strong>Method:</strong> <code>retrieve_relevant_context()</code></p>
                </div>
                
                <div class="rel-card">
                    <h4>DashApp ‚Üí GraphVisualizer</h4>
                    <p><strong>Type:</strong> Dependency</p>
                    <p><strong>Purpose:</strong> Creates interactive network visualizations</p>
                    <p><strong>Method:</strong> <code>create_plotly_figure()</code></p>
                </div>
                
                <div class="rel-card">
                    <h4>Neo4jQueryEngine ‚Üí Neo4jDatabase</h4>
                    <p><strong>Type:</strong> Data Access</p>
                    <p><strong>Purpose:</strong> Executes Cypher queries to retrieve graph data</p>
                    <p><strong>Method:</strong> <code>driver.session().run()</code></p>
                </div>
                
                <div class="rel-card">
                    <h4>Neo4jRAG ‚Üí Neo4jDatabase</h4>
                    <p><strong>Type:</strong> Data Access + Write</p>
                    <p><strong>Purpose:</strong> Reads graph data and writes vector embeddings</p>
                    <p><strong>Method:</strong> Vector similarity search</p>
                </div>
                
                <div class="rel-card">
                    <h4>Neo4jRAG ‚Üí ClaudeAPI</h4>
                    <p><strong>Type:</strong> API Call</p>
                    <p><strong>Purpose:</strong> Sends retrieved context to Claude for answer generation</p>
                    <p><strong>Benefit:</strong> 71% cost reduction through focused context</p>
                </div>
                
                <div class="rel-card">
                    <h4>FilterManager ‚Üí Neo4jQueryEngine</h4>
                    <p><strong>Type:</strong> Uses Data</p>
                    <p><strong>Purpose:</strong> Extracts filter values from query results</p>
                    <p><strong>Method:</strong> <code>extract_all_filters()</code></p>
                </div>
                
                <div class="rel-card">
                    <h4>FastAPIApp ‚Üí DashApp</h4>
                    <p><strong>Type:</strong> Composition/Mounting</p>
                    <p><strong>Purpose:</strong> Mounts Dash as WSGI middleware at /dash route</p>
                    <p><strong>Pattern:</strong> Microservices in single server</p>
                </div>
            </div>
        </div>
        
        <!-- Data Flow -->
        <div class="diagram-section">
            <h2>üîÑ Data Flow Diagram</h2>
            
            <div class="diagram-container">
                <div class="mermaid">
flowchart LR
    User([User])
    Dashboard[Dashboard]
    AISearch[AI Search]
    FilterMgr[FilterManager]
    QueryEngine[QueryEngine]
    Neo4j[(Neo4j)]
    Visualizer[Visualizer]
    NetworkX[NetworkX]
    RAG[RAG]
    Transformer[Transformer]
    Claude[Claude API]
    
    User -->|Select Filters| Dashboard
    User -->|Ask Question| AISearch
    Dashboard --> FilterMgr
    FilterMgr --> QueryEngine
    QueryEngine --> Neo4j
    Neo4j --> QueryEngine
    QueryEngine --> Visualizer
    Visualizer --> NetworkX
    NetworkX --> Visualizer
    Visualizer --> Dashboard
    Dashboard --> User
    AISearch --> RAG
    RAG --> Transformer
    Transformer --> RAG
    RAG --> Neo4j
    Neo4j --> RAG
    RAG --> Claude
    Claude --> AISearch
    AISearch --> User
                </div>
            </div>
        </div>
    </div>
    
    <script>
        mermaid.initialize({ 
            startOnLoad: true, 
            theme: 'default',
            flowchart: {
                curve: 'basis'
            }
        });
    </script>
</body>
</html>
